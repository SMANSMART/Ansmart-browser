<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ansmart Browser - Bookmarks</title>
  <link rel="stylesheet" href="../css/style.css">
  <style>
    body {
      display: grid;
      grid-template-rows: auto 1fr;
      padding: 10px;
      gap: 10px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #bookmarkGrid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
    }

    .bookmarkCard {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      background: #f5f5f5;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .bookmarkCard:hover {
      transform: scale(1.05);
      background: #e0e0e0;
    }

    .bookmarkCard img {
      width: 32px;
      height: 32px;
      margin-bottom: 5px;
    }

    .bookmarkCard span {
      text-align: center;
      font-size: 14px;
      word-break: break-word;
    }

    #addBookmarkBtn {
      padding: 5px 10px;
      border-radius: 5px;
      border: none;
      background: #4caf50;
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <header>
    <h2>Bookmarks</h2>
    <button id="addBookmarkBtn">+ Add Current Page</button>
  </header>

  <div id="bookmarkGrid"></div>

  <script src="../js/storage.js"></script>
  <script>
    const bookmarkGrid = document.getElementById("bookmarkGrid");
    const addBtn = document.getElementById("addBookmarkBtn");

    // Load bookmarks from localStorage
    function loadBookmarks() {
      let bookmarks = JSON.parse(localStorage.getItem("ansmartBookmarks")) || [];

      // If empty, try loading from data/bookmarks.json
      if(bookmarks.length === 0) {
        fetch("../data/bookmarks.json")
          .then(res => res.json())
          .then(data => {
            bookmarks = data.bookmarks.map(b => b.url);
            localStorage.setItem("ansmartBookmarks", JSON.stringify(bookmarks));
            renderBookmarks(bookmarks, data.bookmarks);
          });
      } else {
        renderBookmarks(bookmarks);
      }
    }

    // Render bookmarks in grid
    function renderBookmarks(bookmarks, detailedData = []) {
      bookmarkGrid.innerHTML = "";

      bookmarks.forEach((url) => {
        // Find title & icon if detailedData exists
        let title = url;
        let icon = "https://www.google.com/s2/favicons?domain=" + url;
        if(detailedData.length > 0){
          const match = detailedData.find(b => b.url === url);
          if(match){
            title = match.name || url;
            icon = match.icon || icon;
          }
        }

        const card = document.createElement("div");
        card.classList.add("bookmarkCard");
        card.innerHTML = `<img src="${icon}" alt="icon"><span>${title}</span>`;
        card.addEventListener("click", () => {
          // Open in main iframe
          if(window.opener && window.opener.document.getElementById("browserFrame")){
            window.opener.document.getElementById("browserFrame").src = url;
          }
        });

        bookmarkGrid.appendChild(card);
      });
    }

    // Add current page to bookmarks
    addBtn.addEventListener("click", () => {
      const currentURL = window.opener ? window.opener.document.getElementById("browserFrame").src : null;
      if(currentURL){
        let bookmarks = JSON.parse(localStorage.getItem("ansmartBookmarks")) || [];
        if(!bookmarks.includes(currentURL)){
          bookmarks.push(currentURL);
          localStorage.setItem("ansmartBookmarks", JSON.stringify(bookmarks));
          loadBookmarks();
          alert("Bookmark added!");
        } else {
          alert("Already bookmarked!");
        }
      }
    });

    loadBookmarks();
  </script>
</body>
</html>
